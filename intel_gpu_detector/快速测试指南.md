# ğŸš€ å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ç«‹å³æµ‹è¯•ä½ çš„ä¼˜åŒ–ä»£ç 

### æ­¥éª¤ 1ï¼šè¿è¡Œå½“å‰ä¼˜åŒ–ç‰ˆæœ¬

```bash
cd e:\Desktop\VALORANT\intel_gpu_detector
python simple_detector.py
```

**æœŸæœ›ç»“æœ**ï¼š
- åˆå§‹åŒ–æˆåŠŸ
- è¾“å‡ºæ¨¡å‹è¾“å…¥å°ºå¯¸ç¡®è®¤
- FPS æ˜¾ç¤ºåœ¨çª—å£æ ‡é¢˜æ 

### æ­¥éª¤ 2ï¼šæ£€æŸ¥æ€§èƒ½

è§‚å¯Ÿçª—å£æ ‡é¢˜æ çš„ FPSï¼š
- âœ… **60+ FPS** - ä¼˜åŒ–éå¸¸æˆåŠŸï¼
- âš ï¸ **40-60 FPS** - è‰¯å¥½ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–
- âŒ **< 40 FPS** - éœ€è¦æ’æŸ¥é—®é¢˜

---

## âš ï¸ å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šç¼–è¯‘æ¨¡å‹é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
NameError: name 'self' is not defined
æˆ–
AttributeError: 'YOLOv11DetectorOpenVINO' object has no attribute 'compiled_model'
```

**åŸå› **ï¼šä»£ç ç¬¬ 48 è¡Œåœ¨ `compile_model()` ä¹‹å‰ä½¿ç”¨äº† `self.compiled_model`

**ä¿®å¤**ï¼šä¿®æ”¹ `yolo_detector_openvino.py` ç¬¬ 40-53 è¡Œï¼š

```python
# ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
config = {
    "PERFORMANCE_HINT": "LATENCY",
    "INFERENCE_NUM_THREADS": "4",
    "AFFINITY": "CORE"
}

# è·å–è¾“å…¥ Tensor çš„ shape
input_layer = self.compiled_model.input(0)  # âŒ è¿™é‡Œè¿˜æ²¡å®šä¹‰ compiled_modelï¼

# ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
config = {
    "PERFORMANCE_HINT": "LATENCY",
    "INFERENCE_NUM_THREADS": "4",
    "AFFINITY": "CORE"
}

self.compiled_model = self.core.compile_model(model, device, config)  # âœ… å…ˆç¼–è¯‘
self.infer_request = self.compiled_model.create_infer_request()

# ç„¶åè·å– shape
input_layer = self.compiled_model.input(0)
input_shape = input_layer.shape
self.input_height = input_shape[2]
self.input_width = input_shape[3]
```

---

### é—®é¢˜ 2ï¼šFPS ä»ç„¶å¾ˆä½ï¼ˆ< 40ï¼‰

#### æ£€æŸ¥é¡¹ Aï¼šç¡®è®¤ PPP ç”Ÿæ•ˆ

åœ¨ `yolo_detector_openvino.py` çš„ `__init__` æœ«å°¾æ·»åŠ ï¼š
```python
print(f"[DEBUG] PPP å·²åº”ç”¨: {model is not None}")
print(f"[DEBUG] çº¿ç¨‹æ•°: {config.get('INFERENCE_NUM_THREADS', 'auto')}")
```

#### æ£€æŸ¥é¡¹ Bï¼šç¡®è®¤è¿”å›æ ¼å¼æ­£ç¡®

åœ¨ `detect()` æ–¹æ³•æœ«å°¾æ·»åŠ ï¼š
```python
result = self.postprocess(output, scale, pad, image.shape[:2])
print(f"[DEBUG] æ£€æµ‹åˆ° {len(result)} ä¸ªç›®æ ‡")
return result
```

#### æ£€æŸ¥é¡¹ Cï¼šCPU å ç”¨ç‡

æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œè§‚å¯Ÿï¼š
- **Python è¿›ç¨‹å ç”¨ 25% CPU**ï¼ˆ1 æ ¸æ»¡è½½ï¼‰ - âœ… æ­£å¸¸ï¼ˆå•çº¿ç¨‹ç“¶é¢ˆï¼‰
- **Python è¿›ç¨‹å ç”¨ 100% CPU**ï¼ˆ4 æ ¸æ»¡è½½ï¼‰ - âœ… å¤šçº¿ç¨‹ä¼˜åŒ–ç”Ÿæ•ˆ
- **Python è¿›ç¨‹å ç”¨ < 20% CPU** - âŒ å¯èƒ½æœ‰ç­‰å¾…/é˜»å¡

---

### é—®é¢˜ 3ï¼šdxcam å±æ€§é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
AttributeError: 'DXCamera' object has no attribute 'width'
```

**ä¿®å¤**ï¼šä¿®æ”¹ `simple_detector.py` çš„ `_get_center_region()` æ–¹æ³•ï¼š

```python
def _get_center_region(self) -> Tuple[int, int, int, int]:
    """è®¡ç®—å±å¹•ä¸­å¿ƒåŒºåŸŸåæ ‡"""
    tmp = dxcam.create()

    # æ–¹æ³• 1ï¼šå°è¯•ä½¿ç”¨å±æ€§ï¼ˆå¿«ï¼‰
    try:
        screen_width, screen_height = tmp.width, tmp.height
        print(f"[INFO] å±å¹•å°ºå¯¸: {screen_width} x {screen_height}")
    except AttributeError:
        # æ–¹æ³• 2ï¼šå¤‡ç”¨æ–¹æ¡ˆï¼ŒæŠ“å–ä¸€å¸§
        frame = tmp.grab()
        if frame is not None:
            screen_height, screen_width = frame.shape[:2]
            print(f"[INFO] å±å¹•å°ºå¯¸: {screen_width} x {screen_height}")
        else:
            screen_width, screen_height = 1920, 1080
            print(f"[WARNING] ä½¿ç”¨é»˜è®¤å°ºå¯¸: {screen_width}x{screen_height}")

    del tmp

    left = (screen_width - self.center_size) // 2
    top = (screen_height - self.center_size) // 2
    right = left + self.center_size
    bottom = top + self.center_size

    return (left, top, right, bottom)
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†å¯¹æ¯”

è¿è¡Œ 3 ä¸ªç‰ˆæœ¬ï¼Œå¯¹æ¯” FPSï¼š

### ç‰ˆæœ¬ Aï¼šåŸå§‹ç‰ˆæœ¬ï¼ˆæˆ‘çš„ä»£ç ï¼‰
```bash
cd intel_gpu_detector
git stash  # ä¿å­˜å½“å‰ä¿®æ”¹
git checkout <åŸå§‹æäº¤>  # åˆ‡æ¢åˆ°åŸå§‹ç‰ˆæœ¬
python simple_detector.py
```
**é¢„æœŸ**: 30-40 FPS

### ç‰ˆæœ¬ Bï¼šä½ çš„ä¼˜åŒ–ç‰ˆæœ¬
```bash
git stash pop  # æ¢å¤ä¿®æ”¹
python simple_detector.py
```
**é¢„æœŸ**: 60-80 FPS

### ç‰ˆæœ¬ Cï¼šå…³é—­å¯è§†åŒ–ç‰ˆæœ¬
ä¿®æ”¹ `simple_detector.py`ï¼Œæ³¨é‡Šæ‰ `_render()` è°ƒç”¨ï¼š
```python
# self._render(frame, detections, best_target)

# æ”¹ä¸ºçº¯æ§åˆ¶å°è¾“å‡º
if best_target:
    print(f"\rFPS: {self.fps:.1f} | DIST: {best_target['dist']:.1f}px", end='', flush=True)
else:
    print(f"\rFPS: {self.fps:.1f} | æ— ç›®æ ‡", end='', flush=True)
```
**é¢„æœŸ**: 80-100 FPS

---

## âœ… æˆåŠŸæ ‡å‡†

å¦‚æœä½ çš„ä¼˜åŒ–æˆåŠŸï¼Œåº”è¯¥çœ‹åˆ°ï¼š

1. âœ… **FPS >= 60** ï¼ˆæ¯”åŸæ¥å¿« 2 å€ï¼‰
2. âœ… **CPU å ç”¨ 60-100%**ï¼ˆå……åˆ†åˆ©ç”¨ 4 æ ¸ï¼‰
3. âœ… **æ£€æµ‹å»¶è¿Ÿ < 20ms**
4. âœ… **æ§åˆ¶å°è¾“å‡º**ï¼š
   ```
   [INFO] æ¨ç†è®¾å¤‡: CPU
   [INFO] æ¨¡å‹è¾“å…¥å°ºå¯¸: 256x256
   [INFO] ç±»åˆ«è¿‡æ»¤: åªæ£€æµ‹ 'head' (ID=1)
   æ¨¡å‹è¾“å…¥å°ºå¯¸ç¡®è®¤: Width=256, Height=256
   ```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¦‚æœéœ€è¦ï¼‰

### å¦‚æœ FPS 60-70ï¼ˆä¸å¤Ÿé«˜ï¼‰ï¼š

#### ä¼˜åŒ– 1ï¼šå‡å°æ•è·åŒºåŸŸ
```python
CONFIG = {
    "center_size": 224,  # ä» 256 é™åˆ° 224
    # ...
}
```

#### ä¼˜åŒ– 2ï¼šæé«˜é˜ˆå€¼
```python
CONFIG = {
    "conf_threshold": 0.70,  # ä» 0.65 æé«˜åˆ° 0.70
    # ...
}
```

#### ä¼˜åŒ– 3ï¼šå…³é—­å¯è§†åŒ–
```python
# åœ¨ run() ä¸­æ³¨é‡Šæ‰
# self._render(frame, detections, best_target)
```

### å¦‚æœ FPS å·²ç» 80+ï¼ˆå¾ˆå¥½ï¼‰ï¼š

æ­å–œï¼ä½ çš„ä¼˜åŒ–éå¸¸æˆåŠŸï¼å¯ä»¥å°è¯•ï¼š
1. æé«˜æ£€æµ‹ç²¾åº¦ï¼šé™ä½ `conf_threshold` åˆ° 0.55
2. æ‰©å¤§æ£€æµ‹èŒƒå›´ï¼šå¢åŠ  `center_size` åˆ° 320
3. æ·»åŠ å…¶ä»–ç±»åˆ«ï¼š`filter_class = None`ï¼ˆæ£€æµ‹æ‰€æœ‰ç±»åˆ«ï¼‰

---

## ğŸ“ æ€§èƒ½è®°å½•æ¨¡æ¿

æµ‹è¯•å®Œæˆåï¼Œè®°å½•ç»“æœï¼š

```
æµ‹è¯•æ—¥æœŸï¼š2026-01-XX
ç¡¬ä»¶ï¼ši3-10105F + GT 1030

| ç‰ˆæœ¬ | FPS | CPU å ç”¨ | å¤‡æ³¨ |
|-----|-----|---------|------|
| åŸå§‹ç‰ˆæœ¬ | 30 | 25% | - |
| ä¼˜åŒ–ç‰ˆæœ¬ | 75 | 85% | OpenVINO PPP + NumPy |
| æ— å¯è§†åŒ– | 95 | 90% | å»æ‰ cv2.imshow |
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### æ·»åŠ æ€§èƒ½åˆ†æ

åœ¨ `simple_detector.py` çš„ `run()` ä¸­æ·»åŠ è¯¦ç»†è®¡æ—¶ï¼š

```python
def run(self):
    try:
        while True:
            t_start = time.perf_counter()

            # 1. æŠ“å›¾
            t1 = time.perf_counter()
            frame = self.camera.get_latest_frame()
            t_capture = (time.perf_counter() - t1) * 1000

            if frame is None: continue

            # 2. æ¨ç†
            t2 = time.perf_counter()
            detections = self.detector.detect(frame)
            t_infer = (time.perf_counter() - t2) * 1000

            # 3. ç›®æ ‡é€‰æ‹©
            t3 = time.perf_counter()
            best_target = self.find_best_target(detections)
            t_select = (time.perf_counter() - t3) * 1000

            # 4. å¯è§†åŒ–
            t4 = time.perf_counter()
            self._render(frame, detections, best_target)
            t_render = (time.perf_counter() - t4) * 1000

            # æ€»æ—¶é—´
            t_total = (time.perf_counter() - t_start) * 1000

            # æ¯ 30 å¸§æ‰“å°ä¸€æ¬¡
            if len(self.frame_times) % 30 == 0:
                print(f"\n[æ€§èƒ½åˆ†æ]")
                print(f"  æŠ“å›¾: {t_capture:.1f}ms")
                print(f"  æ¨ç†: {t_infer:.1f}ms")
                print(f"  é€‰æ‹©: {t_select:.1f}ms")
                print(f"  æ¸²æŸ“: {t_render:.1f}ms")
                print(f"  æ€»è®¡: {t_total:.1f}ms ({1000/t_total:.1f} FPS)")

            # ... åç»­ä»£ç 
```

---

## ğŸ‰ é¢„æœŸç»“æœ

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

```
================================================================================
VALORANT å®æ—¶æ£€æµ‹ç³»ç»Ÿ - æ·±åº¦ä¼˜åŒ–ç‰ˆ (æ•è·ä¸­å¿ƒ 256x256)
================================================================================

[1/2] åŠ è½½ OpenVINO æ¨ç†å¼•æ“ (å‘é‡åŒ–ç‰ˆæœ¬)...
[INFO] æ¨ç†è®¾å¤‡: CPU
[INFO] æ¨¡å‹è¾“å…¥å°ºå¯¸: 256x256
[INFO] ç±»åˆ«è¿‡æ»¤: åªæ£€æµ‹ 'head' (ID=1)
æ¨¡å‹è¾“å…¥å°ºå¯¸ç¡®è®¤: Width=256, Height=256

[2/2] åˆå§‹åŒ– DXCam æ•è·...
[INFO] å±å¹•å°ºå¯¸: 1920 x 1080
[INFO] æ•è·åŒºåŸŸ: (832, 412, 1088, 668)

[SUCCESS] ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ! å‡†å¤‡å¼€å§‹æ£€æµ‹...
================================================================================

æ£€æµ‹è¿è¡Œä¸­... æŒ‰ 'Q' é”®åœ¨è§†é¢‘çª—å£é€€å‡º
================================================================================

[çª—å£æ ‡é¢˜æ æ˜¾ç¤º] FPS: 72.3 | Targets: 1
```

**FPS ä» 30 æå‡åˆ° 70+ï¼ŒæˆåŠŸï¼** ğŸŠ
